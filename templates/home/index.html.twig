{% extends 'base.html.twig' %}
{% block title %}SnowTricks{% endblock %}

{% block body %}
<main class="container">
  <div class="bg-image my-3" style="background: center/cover url('assets/pictures/main.jpg')">
    <h1 class="text-center">Partager vos tricks avec la communaut√©</h1>
    <a href="#tricks-container"><i class="fa-sharp fa-regular fa-arrow-down"></i></a>
  </div>
  <hr>
 
    {% if app.user and app.user.isVerified %}
    <div class="row text-center">
    <a href="{{path('add_trick')}}" class="fw-bold">Ajouter une figure</a> <br>
    </div>
    <hr>
    {% endif %}
 
 
  <section class="row row-cols-1 row-cols-md-3 row-cols-lg-5 g-4 my-3">
    {% for trick in tricks|slice(0, 5) %}
    <div class="col">
      <div class="card h-100 mb-3 shadow-sm">
        {% include "_partials/_main_picture.html.twig" with { "tricks" : trick.medias, "display" : "img"} %}
        <div class="card-text">
          <div class="row mt-3 ms-3">
            <div class="col-6"><a href="{{ path('app_trick', {'slug' : trick.slug})}}">
                <h5 class="card-title">{{trick.name}}</h5></a>
            </div>
            <div class="col-6">
              {% include "_partials/_link_trick.html.twig" with { "user" : app.user, "class1" : "row", "class2" :
              "col-6", "edit" : "" , "delete": ""}%}
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </section>

  <section class="row row-cols-1 row-cols-md-5 g-4 my-3" id="tricks-container"></section>
  {% if tricks|length >5 %}
  <div class="text-center">
    <button id="load-more" class="btn my-5"><i class="fa-regular fa-spinner"></i> Charger plus</button>
  </div>
  {% endif %}

  <script>
    const loadMoreBtn = document.getElementById('load-more');
    let offset = 0;
    loadMoreBtn.addEventListener('click', function () {
      offset += 5;
      const url = '{{ path('more_tricks', {'offset': 0}) }}'.replace('0', offset);
      fetch(url)
        .then(response => response.json())
        .then(data => {
          const tricksContainer = document.getElementById('tricks-container');
          tricksContainer.insertAdjacentHTML('beforeend', data.html);
          console.log(document.getElementsByClassName("card-img-top").length % 5)
          if (document.getElementsByClassName("card-img-top").length == {{ tricks|length }}) {
          loadMoreBtn.style.display = 'none';
          }
        });
      });
  </script>
</main>
{% endblock %}